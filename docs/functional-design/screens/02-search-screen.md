# 画面詳細設計：求人検索画面 (Search Screen)

## 1. 概要
- **目的**: 自然文検索および除外条件を用いて、要件に合致する求人を検索し、一覧表示する。
- **パス**: `/search`

## 2. 構成要素 (UI Components)
- **検索フォーム (Search Form Card)**:
  - 自然文検索条件 (Textarea): AIが解析するための詳細な要件入力。
  - **詳細条件 (Advanced Filters)**: (トグルで開閉)
    - 言語・フレームワーク・インフラ (Input, タグ形式):
      - 選択された項目はビジュアルタグ（削除ボタン付き）として表示。
      - 重複選択はシステム側で自動的に防止。
      - サジェストにない項目も Enter キーで自由入力・タグ化が可能。
      - 入力確定時（選択またはEnter）、入力欄を強制的にリセット（Remount）し、IMEの未確定文字（ゴーストテキスト）を排除するロジックを実装。
    - 勤務地 (Input, タグ形式): 
      - 47都道府県、政令指定都市、県庁所在地を包括的にサジェスト。
      - 読み仮名検索（例：「とう」→「東京都」）に対応。
      - 技術スタック同様、サジェスト外の場所も自由入力（Enter）で追加可能。
      - 選択・確定時のIMEクリアリング（Remountロジック）を統一適用。
      - **重複選択の防止**: 同一名称の重複だけでなく、「東京」と「東京都」のような「都・道・府・県」の有無による重複も正規化ロジックにより一貫して防止する。
    - 希望年収 (Select): 最低希望年収の選択（最大1400万円以上まで）。
    - 働き方・その他オプション (Badge Toggle): リモート、フルリモート、フレックス、フルフレックス等の選択。
  - 除外条件 (Input): 検索結果から除外するキーワード入力。
  - 検索実行ボタン (Button): 検索のトリガー。ローディングアニメーション付き。
  - **検索履歴 (History/Recent Searches)**:
    - 検索実行ボタンの下部（または検索窓フォーカス時のPopover）に表示。
    - **機能**:
      - 過去の検索条件をリスト表示 (最大10件)。
      - クリックで検索条件をフォームにセットし、再検索を実行。
      - 各履歴には「検索サマリー」を表示。自然文検索条件・除外条件は長すぎる場合、省略表示（Truncate）する。
      - 11件以上になると古いものから自動削除される。
- **検索結果一覧 (Results Grid)**:
  - 求人カード (Job Card): 
    - タイトル、企業名、勤務地、給与、AI評価スコア。
    - お気に入り登録・解除ボタン (Heart Icon)。
    - 詳細を見るボタン (Button): 詳細画面への遷移。
- **空状態表示 (Empty State Card)**: 検索結果が0件の場合のメッセージとイラストを表示。

## 3. 機能・ロジック
- **検索ロジック**:
  - **Real API Integration**: `/api/jobs` エンドポイントをコールし、実際にデータベースから求人を検索する。
  - 除外条件に指定されたキーワードが含まれるデータを排除。
  - **検索履歴の挙動**:
    - 履歴アイテムを選択して検索条件を復元・実行した際は、**新規の履歴保存を行わない**（重複防止のため）。
    - 履歴リストは常に表示され、空の場合は0件として扱われる。
- **お気に入り機能**:
  - カード上のハートアイコンをクリックすることで、グローバルな `favoriteJobIds` を更新。
  - リアクションとしてハートの塗りつぶし状態をトグル。
- **スコアカラーリング**:
  - スコアの値に応じてバッジの色を変更 (4.5以上: success, 3.5以上: default, その他: secondary)。

## 4. 遷移
- **詳細を見る**: → [求人詳細画面](./03-detail-screen.md)
- **サイドバー**: [お気に入り一覧画面](./04-favorites-screen.md) へのナビゲーションを提供。

## 5. データ要件
- `mockData.ts` の `mockJobs` 配列を利用。
- データの主要フィールド: `id`, `title`, `company`, `location`, `salary`, `score`。
